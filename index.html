<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0a0c10" />
  <title>YC Analyst</title>

  <!-- Telegram Mini App SDK ‚Äî MUST be first -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- React & ReactDOM from CDN -->
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

  <!-- Babel standalone to compile JSX in the browser -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #root { height: 100%; background: #0a0c10; }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="api-key-modal" style="position:fixed;inset:0;background:#0a0c10;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px;font-family:'Space Mono',monospace;">
    <div style="background:#12151c;border:1px solid #1e2435;border-radius:16px;padding:28px 24px;width:100%;max-width:400px;">
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:800;color:#e8ecf4;margin-bottom:6px;">‚ö° YC ANALYST</div>
      <div style="font-size:10px;color:#00e5ff;letter-spacing:2px;text-transform:uppercase;margin-bottom:20px;">Setup Required</div>
      <div style="font-size:12px;color:#a0aabe;line-height:1.7;margin-bottom:20px;">
        Enter your Anthropic API key to enable AI-powered match analysis. Your key is stored only on this device.
        <br/><br/>
        Get a free key at <span style="color:#00e5ff;">console.anthropic.com</span>
      </div>
      <div style="font-size:10px;color:#6b7591;letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;">API Key</div>
      <input
        id="api-key-input"
        type="password"
        placeholder="sk-ant-..."
        style="width:100%;padding:13px 14px;background:#1a1f2a;border:1px solid #1e2435;border-radius:10px;font-family:'Space Mono',monospace;font-size:13px;color:#e8ecf4;outline:none;margin-bottom:14px;"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="off"
      />
      <button
        onclick="saveApiKey()"
        style="width:100%;padding:14px;background:linear-gradient(135deg,#00e5ff,#7c4dff);border:none;border-radius:12px;font-family:'Barlow Condensed',sans-serif;font-size:17px;font-weight:800;letter-spacing:2px;color:#000;cursor:pointer;"
      >
        SAVE & LAUNCH
      </button>
      <div id="api-key-error" style="color:#ff4444;font-size:11px;margin-top:10px;display:none;">Please enter a valid API key (starts with sk-ant-)</div>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const SPORTS = ["Football", "Basketball", "Tennis", "Cricket", "Baseball", "Hockey"];

const ANALYSIS_PROMPT = (match, sport) => `You are an elite sports analyst AI. Run a DEEP ANALYSIS on the following ${sport} match: "${match}".

Use your web search tool to find:
- Current team/player form (last 5-10 matches)
- Head-to-head historical stats
- Injury and suspension news
- Tactical matchups and lineup info
- Weather/venue conditions
- Expert predictions and media sentiment
- Betting odds movement
- Recent home/away performance

Then generate AS MANY distinct prediction markets as are relevant for this ${sport} match. Do NOT limit yourself ‚Äî cover every angle that the data supports. Aim for 8-15 predictions. Only include a prediction if its confidence is between 60 and 99 (NEVER below 60, NEVER above 99). Skip any market where confidence would fall below 60.

For ${sport}, consider all applicable markets such as (but NOT limited to):
- Match Result / Winner
- Both Teams to Score
- Over/Under (various lines e.g. 0.5, 1.5, 2.5, 3.5 goals/points)
- First Half / Second Half result
- Correct Score
- Asian Handicap / Spread
- Double Chance
- Clean Sheet (Home or Away)
- Anytime Goalscorer / Top Performer
- Total Corners / Cards
- First Goal / Last Goal
- Half Time / Full Time
- Team to Score First
- Draw No Bet
- Winning Margin
- Any other sport-specific markets that make sense

Respond ONLY with valid JSON, no markdown, no backticks, no explanation:
{
  "match": "<Team A> vs <Team B>",
  "sport": "${sport}",
  "summary": "<2-3 sentence overview of the match context and key storylines>",
  "factors": {
    "form": "<brief>",
    "h2h": "<brief>",
    "injuries": "<brief>",
    "tactics": "<brief>",
    "odds": "<brief>"
  },
  "keyInsights": ["<insight 1>", "<insight 2>", "<insight 3>"],
  "predictions": [
    {
      "market": "<market name>",
      "pick": "<your pick>",
      "confidence": <number between 60 and 99>,
      "reasoning": "<1-2 sentence reasoning backed by data>",
      "riskLevel": "<Low|Medium|High>"
    }
  ]
}`;

function App() {
  const [tab, setTab] = useState("home");
  const [sport, setSport] = useState("Football");
  const [matchInput, setMatchInput] = useState("");
  const [loading, setLoading] = useState(false);
  const [analysis, setAnalysis] = useState(null);
  const [error, setError] = useState("");
  const [history, setHistory] = useState([]);
  const [loadingHistory, setLoadingHistory] = useState(true);
  const inputRef = useRef(null);

  useEffect(() => {
    if (window.Telegram?.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();
    }
    loadHistory();
  }, []);

  function loadHistory() {
    setLoadingHistory(true);
    try {
      const saved = localStorage.getItem("yc-history");
      if (saved) setHistory(JSON.parse(saved));
    } catch (_) {}
    setLoadingHistory(false);
  }

  function saveHistory(updated) {
    try {
      localStorage.setItem("yc-history", JSON.stringify(updated));
    } catch (_) {}
  }

  async function runAnalysis() {
    if (!matchInput.trim()) {
      setError("Please enter a match, e.g. Arsenal vs Chelsea");
      return;
    }
    setError("");
    setLoading(true);
    setAnalysis(null);

    try {
      const messages = [{ role: "user", content: ANALYSIS_PROMPT(matchInput, sport) }];
      const tools = [{ type: "web_search_20250305", name: "web_search" }];
      let finalText = "";

      for (let i = 0; i < 10; i++) {
        const response = await fetch("/.netlify/functions/analyze", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 5000,
            tools,
            messages,
          }),
        });

        const data = await response.json();
        if (!response.ok) throw new Error(data.error?.message || "API error");

        messages.push({ role: "assistant", content: data.content });

        if (data.stop_reason === "end_turn") {
          finalText = data.content.filter(b => b.type === "text").map(b => b.text).join("");
          break;
        }

        if (data.stop_reason === "tool_use") {
          const toolResults = data.content
            .filter(b => b.type === "tool_use")
            .map(b => ({ type: "tool_result", tool_use_id: b.id, content: "Search completed." }));
          messages.push({ role: "user", content: toolResults });
          continue;
        }

        finalText = data.content.filter(b => b.type === "text").map(b => b.text).join("");
        if (finalText) break;
      }

      if (!finalText) throw new Error("No response received");

      const stripped = finalText.replace(/```json\s*|```\s*/g, "").trim();
      const jsonStart = stripped.indexOf("{");
      const jsonEnd = stripped.lastIndexOf("}");
      if (jsonStart === -1 || jsonEnd === -1) throw new Error("Invalid response format");
      const parsed = JSON.parse(stripped.slice(jsonStart, jsonEnd + 1));

      // Enforce confidence range 60-99
      parsed.predictions = (parsed.predictions || []).map((p, idx) => ({
        ...p,
        id: `${Date.now()}-${idx}`,
        outcome: "pending",
        confidence: Math.min(99, Math.max(60, p.confidence)),
      }));

      const entry = {
        id: Date.now(),
        match: parsed.match,
        sport: parsed.sport,
        timestamp: new Date().toISOString(),
        summary: parsed.summary,
        factors: parsed.factors,
        keyInsights: parsed.keyInsights,
        predictions: parsed.predictions,
      };

      setAnalysis(entry);
      const updated = [entry, ...history].slice(0, 30);
      setHistory(updated);
      await saveHistory(updated);
    } catch (err) {
      console.error(err);
      setError(`Analysis failed: ${err.message || "Please try again."}`);
    }
    setLoading(false);
  }

  async function markOutcome(entryId, predId, outcome) {
    const updateEntry = (e) => {
      if (e.id !== entryId) return e;
      return { ...e, predictions: e.predictions.map(p => p.id === predId ? { ...p, outcome } : p) };
    };
    const updatedHistory = history.map(updateEntry);
    const updatedAnalysis = analysis?.id === entryId ? updateEntry(analysis) : analysis;
    setHistory(updatedHistory);
    setAnalysis(updatedAnalysis);
    await saveHistory(updatedHistory);
  }

  // Stats
  const allPreds = history.flatMap(e => e.predictions || []);
  const wins = allPreds.filter(p => p.outcome === "win").length;
  const losses = allPreds.filter(p => p.outcome === "loss").length;
  const settled = wins + losses;
  const winRate = settled > 0 ? Math.round((wins / settled) * 100) : null;

  const riskColor = r => r === "Low" ? "#00e676" : r === "Medium" ? "#ffb300" : "#ff4444";
  const confColor = c => c >= 80 ? "#00e676" : c >= 65 ? "#ffb300" : "#ff4444";

  return (
    <>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
          --bg: #0a0c10; --surface: #12151c; --surface2: #1a1f2a;
          --border: #1e2435; --accent: #00e5ff; --accent2: #7c4dff;
          --green: #00e676; --red: #ff4444; --yellow: #ffb300;
          --text: #e8ecf4; --muted: #6b7591;
        }
        body { font-family: 'Space Mono', monospace; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
        .app { max-width: 480px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; background: var(--bg); }

        .header { padding: 20px 20px 16px; background: linear-gradient(135deg,#0a0c10,#12151c); border-bottom: 1px solid var(--border); position: relative; overflow: hidden; }
        .header::before { content:''; position:absolute; top:-30px; right:-30px; width:120px; height:120px; background:radial-gradient(circle,rgba(0,229,255,.12) 0%,transparent 70%); pointer-events:none; }
        .header-top { display:flex; align-items:center; gap:12px; }
        .logo { width:40px; height:40px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; box-shadow:0 4px 16px rgba(0,229,255,.25); }
        .header-text h1 { font-family:'Barlow Condensed',sans-serif; font-size:22px; font-weight:800; letter-spacing:1px; }
        .header-text span { font-size:10px; color:var(--accent); letter-spacing:2px; text-transform:uppercase; }
        .live-badge { margin-left:auto; display:flex; align-items:center; gap:5px; font-size:10px; color:var(--green); letter-spacing:1px; }
        .live-dot { width:6px; height:6px; border-radius:50%; background:var(--green); animation:pulse 1.5s infinite; }
        @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.8)} }

        .tabs { display:flex; background:var(--surface); border-top:1px solid var(--border); position:sticky; bottom:0; z-index:100; }
        .tab { flex:1; padding:14px; text-align:center; font-family:'Barlow Condensed',sans-serif; font-size:14px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); cursor:pointer; border:none; background:transparent; position:relative; transition:color .2s; }
        .tab.active { color:var(--accent); }
        .tab.active::after { content:''; position:absolute; top:0; left:20%; right:20%; height:2px; background:var(--accent); border-radius:0 0 2px 2px; box-shadow:0 0 8px var(--accent); }

        .content { flex:1; padding:20px; overflow-y:auto; }

        .sport-grid { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
        .sport-chip { padding:6px 14px; border-radius:20px; border:1px solid var(--border); background:var(--surface); font-family:'Space Mono',monospace; font-size:11px; color:var(--muted); cursor:pointer; transition:all .2s; }
        .sport-chip.active { border-color:var(--accent); color:var(--accent); background:rgba(0,229,255,.08); box-shadow:0 0 12px rgba(0,229,255,.15); }

        .input-label { font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; display:block; }
        .input-group { margin-bottom:16px; }
        .match-input { width:100%; padding:14px 16px; background:var(--surface2); border:1px solid var(--border); border-radius:10px; font-family:'Barlow Condensed',sans-serif; font-size:18px; font-weight:600; color:var(--text); outline:none; transition:border-color .2s,box-shadow .2s; letter-spacing:.5px; }
        .match-input::placeholder { color:var(--muted); }
        .match-input:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,229,255,.08); }

        .analyze-btn { width:100%; padding:16px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border:none; border-radius:12px; font-family:'Barlow Condensed',sans-serif; font-size:18px; font-weight:800; letter-spacing:2px; text-transform:uppercase; color:#000; cursor:pointer; transition:opacity .2s,transform .1s; box-shadow:0 4px 20px rgba(0,229,255,.3); }
        .analyze-btn:active { transform:scale(.98); }
        .analyze-btn:disabled { opacity:.5; cursor:not-allowed; }

        .loading-card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:32px 20px; text-align:center; margin-top:20px; }
        .spinner { width:44px; height:44px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin .8s linear infinite; margin:0 auto 16px; }
        @keyframes spin { to { transform:rotate(360deg); } }
        .loading-steps span { display:block; font-size:11px; color:var(--muted); line-height:2.2; letter-spacing:1px; animation:fadeSlide .5s ease forwards; opacity:0; }
        .loading-steps span:nth-child(1){animation-delay:.2s}
        .loading-steps span:nth-child(2){animation-delay:1.2s}
        .loading-steps span:nth-child(3){animation-delay:2.4s}
        .loading-steps span:nth-child(4){animation-delay:3.6s}
        .loading-steps span:nth-child(5){animation-delay:4.8s}
        @keyframes fadeSlide { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:translateY(0)} }

        .error-msg { color:var(--red); font-size:12px; margin-top:10px; padding:10px 14px; background:rgba(255,68,68,.08); border:1px solid rgba(255,68,68,.2); border-radius:8px; }

        /* Analysis result */
        @keyframes slideUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }

        .match-header-card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:18px 20px; margin-top:20px; animation:slideUp .3s ease; }
        .mh-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
        .mh-title { font-family:'Barlow Condensed',sans-serif; font-size:24px; font-weight:800; letter-spacing:.5px; }
        .mh-sport { font-size:10px; color:var(--accent); letter-spacing:2px; text-transform:uppercase; margin-top:2px; }
        .mh-count { font-size:10px; color:var(--muted); letter-spacing:1px; text-align:right; }
        .mh-count strong { font-family:'Barlow Condensed',sans-serif; font-size:22px; font-weight:800; color:var(--accent); display:block; line-height:1; }
        .summary-text { font-size:12px; line-height:1.7; color:#a0aabe; margin-bottom:14px; }
        .section-title { font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:10px; }
        .insights-list { display:flex; flex-direction:column; gap:6px; }
        .insight-item { display:flex; gap:8px; font-size:11px; line-height:1.5; color:var(--text); }
        .insight-dot { width:5px; height:5px; border-radius:50%; background:var(--accent); margin-top:5px; flex-shrink:0; box-shadow:0 0 6px rgba(0,229,255,.6); }

        .factors-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:12px; }
        .factor-item { background:var(--surface2); border:1px solid var(--border); border-radius:8px; padding:10px 12px; }
        .factor-name { font-size:9px; color:var(--accent); letter-spacing:2px; text-transform:uppercase; margin-bottom:4px; }
        .factor-text { font-size:11px; color:var(--text); line-height:1.4; }

        /* Prediction cards */
        .preds-section-title { font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin:20px 0 12px; }
        .pred-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; margin-bottom:12px; overflow:hidden; animation:slideUp .3s ease; }
        .pred-card-top { padding:14px 16px 12px; }
        .pred-market { font-size:10px; color:var(--accent); letter-spacing:2px; text-transform:uppercase; margin-bottom:6px; }
        .pred-pick { font-family:'Barlow Condensed',sans-serif; font-size:24px; font-weight:800; color:var(--text); letter-spacing:.5px; line-height:1.1; }
        .pred-reasoning { font-size:11px; color:#8a94aa; margin-top:6px; line-height:1.5; }

        .pred-meta { display:flex; gap:10px; align-items:center; padding:10px 16px; background:var(--surface2); border-top:1px solid var(--border); }
        .conf-pill { display:flex; align-items:center; gap:6px; flex:1; }
        .conf-num { font-family:'Barlow Condensed',sans-serif; font-size:20px; font-weight:800; }
        .conf-label { font-size:9px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; }
        .conf-bar-mini { flex:1; height:5px; background:var(--border); border-radius:3px; overflow:hidden; }
        .conf-bar-mini-fill { height:100%; border-radius:3px; }
        .risk-tag { font-size:10px; font-weight:700; letter-spacing:1px; padding:3px 10px; border-radius:12px; font-family:'Barlow Condensed',sans-serif; }

        .outcome-row { display:flex; gap:8px; padding:10px 16px; border-top:1px solid var(--border); align-items:center; }
        .outcome-label { font-size:10px; color:var(--muted); letter-spacing:1px; flex-shrink:0; }
        .outcome-btn { flex:1; padding:8px; border-radius:8px; border:1px solid; background:transparent; font-family:'Barlow Condensed',sans-serif; font-size:13px; font-weight:700; letter-spacing:1px; cursor:pointer; transition:all .2s; }
        .outcome-btn.win { border-color:var(--green); color:var(--green); }
        .outcome-btn.win.active, .outcome-btn.win:hover { background:rgba(0,230,118,.15); }
        .outcome-btn.loss { border-color:var(--red); color:var(--red); }
        .outcome-btn.loss.active, .outcome-btn.loss:hover { background:rgba(255,68,68,.15); }

        /* Account tab */
        .stats-banner { background:linear-gradient(135deg,rgba(0,229,255,.08),rgba(124,77,255,.08)); border:1px solid var(--border); border-radius:16px; padding:24px 20px; margin-bottom:20px; text-align:center; }
        .win-rate { font-family:'Barlow Condensed',sans-serif; font-size:64px; font-weight:800; background:linear-gradient(135deg,var(--accent),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; line-height:1; }
        .win-rate-label { font-size:11px; color:var(--muted); letter-spacing:3px; text-transform:uppercase; margin-top:4px; }
        .stats-row { display:flex; gap:12px; margin-top:20px; justify-content:center; }
        .stat-box { background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:12px 20px; text-align:center; min-width:70px; }
        .stat-num { font-family:'Barlow Condensed',sans-serif; font-size:28px; font-weight:800; }
        .stat-lbl { font-size:9px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; }

        .history-title { font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:12px; }
        .history-entry { background:var(--surface); border:1px solid var(--border); border-radius:14px; margin-bottom:14px; overflow:hidden; }
        .history-entry-header { padding:12px 16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
        .history-match { font-family:'Barlow Condensed',sans-serif; font-size:17px; font-weight:800; }
        .history-meta { font-size:10px; color:var(--muted); letter-spacing:1px; margin-top:2px; }
        .history-pred-row { display:flex; justify-content:space-between; align-items:center; padding:9px 16px; border-bottom:1px solid var(--border); }
        .history-pred-row:last-child { border-bottom:none; }
        .history-pred-market { font-size:10px; color:var(--muted); letter-spacing:1px; }
        .history-pred-pick { font-family:'Barlow Condensed',sans-serif; font-size:15px; font-weight:700; }
        .history-pred-conf { font-size:11px; color:var(--muted); }
        .outcome-badge { padding:4px 12px; border-radius:20px; font-size:10px; font-weight:700; letter-spacing:1px; flex-shrink:0; font-family:'Barlow Condensed',sans-serif; }
        .badge-win { background:rgba(0,230,118,.15); color:var(--green); border:1px solid rgba(0,230,118,.3); }
        .badge-loss { background:rgba(255,68,68,.15); color:var(--red); border:1px solid rgba(255,68,68,.3); }
        .badge-pending { background:rgba(255,179,0,.1); color:var(--yellow); border:1px solid rgba(255,179,0,.3); }

        .empty-state { text-align:center; padding:48px 20px; color:var(--muted); }
        .empty-icon { font-size:48px; margin-bottom:12px; }
        .empty-text { font-size:13px; line-height:1.6; letter-spacing:.5px; }
      `}</style>

      <script src="https://telegram.org/js/telegram-web-app.js" />

      <div className="app">
        {/* Header */}
        <div className="header">
          <div className="header-top">
            <div className="logo">‚ö°</div>
            <div className="header-text">
              <h1>YC ANALYST</h1>
              <span>Sports Intelligence Engine</span>
            </div>
            <div className="live-badge">
              <div className="live-dot" />
              LIVE DATA
            </div>
          </div>
        </div>

        {/* HOME TAB */}
        {tab === "home" && (
          <div className="content">
            <span className="input-label">Select Sport</span>
            <div className="sport-grid">
              {SPORTS.map(s => (
                <button key={s} className={`sport-chip ${sport === s ? "active" : ""}`} onClick={() => setSport(s)}>{s}</button>
              ))}
            </div>

            <div className="input-group">
              <span className="input-label">Enter Match</span>
              <input
                ref={inputRef}
                className="match-input"
                placeholder="e.g. Arsenal vs Chelsea"
                value={matchInput}
                onChange={e => setMatchInput(e.target.value)}
                onKeyDown={e => e.key === "Enter" && !loading && runAnalysis()}
              />
            </div>

            <button className="analyze-btn" onClick={runAnalysis} disabled={loading}>
              {loading ? "‚è≥ Analysing..." : "‚ö° Run Deep Analysis"}
            </button>

            {error && <div className="error-msg">‚ö† {error}</div>}

            {loading && (
              <div className="loading-card">
                <div className="spinner" />
                <div style={{ fontFamily: "'Barlow Condensed',sans-serif", fontSize: 16, fontWeight: 700, letterSpacing: 1, marginBottom: 12 }}>
                  Running Deep Analysis...
                </div>
                <div className="loading-steps">
                  <span>üîç Searching live match data...</span>
                  <span>üìä Analysing team form & H2H...</span>
                  <span>üè• Checking injuries & suspensions...</span>
                  <span>üìà Reading betting odds movement...</span>
                  <span>üß† Generating multiple predictions...</span>
                </div>
              </div>
            )}

            {analysis && !loading && (
              <>
                {/* Match Summary Card */}
                <div className="match-header-card">
                  <div className="mh-top">
                    <div>
                      <div className="mh-title">{analysis.match}</div>
                      <div className="mh-sport">‚óÜ {analysis.sport}</div>
                    </div>
                    <div className="mh-count">
                      <strong>{analysis.predictions.length}</strong>
                      PREDICTIONS
                    </div>
                  </div>

                  {analysis.summary && <p className="summary-text">{analysis.summary}</p>}

                  {analysis.keyInsights?.length > 0 && (
                    <>
                      <div className="section-title">Key Insights</div>
                      <div className="insights-list">
                        {analysis.keyInsights.map((ins, i) => (
                          <div key={i} className="insight-item">
                            <div className="insight-dot" />
                            <span>{ins}</span>
                          </div>
                        ))}
                      </div>
                    </>
                  )}

                  {analysis.factors && (
                    <div className="factors-grid">
                      {Object.entries(analysis.factors).map(([k, v]) => (
                        <div key={k} className="factor-item">
                          <div className="factor-name">{k}</div>
                          <div className="factor-text">{v}</div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                {/* Prediction Cards */}
                <div className="preds-section-title">
                  ‚óÜ {analysis.predictions.length} Predictions ‚Äî All 60‚Äì99% Confidence
                </div>

                {analysis.predictions.map((pred, i) => (
                  <div key={pred.id} className="pred-card" style={{ animationDelay: `${i * 0.06}s` }}>
                    <div className="pred-card-top">
                      <div className="pred-market">{pred.market}</div>
                      <div className="pred-pick">{pred.pick}</div>
                      {pred.reasoning && <div className="pred-reasoning">{pred.reasoning}</div>}
                    </div>

                    <div className="pred-meta">
                      <div className="conf-pill">
                        <div>
                          <div className="conf-num" style={{ color: confColor(pred.confidence) }}>{pred.confidence}%</div>
                          <div className="conf-label">CONF</div>
                        </div>
                        <div className="conf-bar-mini">
                          <div className="conf-bar-mini-fill" style={{
                            width: `${pred.confidence}%`,
                            background: `linear-gradient(90deg, ${confColor(pred.confidence)}, var(--accent2))`
                          }} />
                        </div>
                      </div>
                      <div className="risk-tag" style={{
                        color: riskColor(pred.riskLevel),
                        background: `${riskColor(pred.riskLevel)}18`,
                        border: `1px solid ${riskColor(pred.riskLevel)}40`
                      }}>
                        {pred.riskLevel}
                      </div>
                    </div>

                    <div className="outcome-row">
                      <span className="outcome-label">RESULT:</span>
                      {pred.outcome === "pending" ? (
                        <>
                          <button className="outcome-btn win" onClick={() => markOutcome(analysis.id, pred.id, "win")}>‚úì WIN</button>
                          <button className="outcome-btn loss" onClick={() => markOutcome(analysis.id, pred.id, "loss")}>‚úó LOSS</button>
                        </>
                      ) : (
                        <>
                          <button className={`outcome-btn win ${pred.outcome === "win" ? "active" : ""}`} onClick={() => markOutcome(analysis.id, pred.id, "win")}>‚úì WIN</button>
                          <button className={`outcome-btn loss ${pred.outcome === "loss" ? "active" : ""}`} onClick={() => markOutcome(analysis.id, pred.id, "loss")}>‚úó LOSS</button>
                        </>
                      )}
                    </div>
                  </div>
                ))}
              </>
            )}
          </div>
        )}

        {/* ACCOUNT TAB */}
        {tab === "account" && (
          <div className="content">
            <div className="stats-banner">
              {winRate !== null ? (
                <>
                  <div className="win-rate">{winRate}%</div>
                  <div className="win-rate-label">Prediction Win Rate</div>
                </>
              ) : (
                <>
                  <div className="win-rate" style={{ fontSize: 36 }}>‚Äî</div>
                  <div className="win-rate-label">No results logged yet</div>
                </>
              )}
              <div className="stats-row">
                <div className="stat-box">
                  <div className="stat-num" style={{ color: "var(--green)" }}>{wins}</div>
                  <div className="stat-lbl">Wins</div>
                </div>
                <div className="stat-box">
                  <div className="stat-num" style={{ color: "var(--red)" }}>{losses}</div>
                  <div className="stat-lbl">Losses</div>
                </div>
                <div className="stat-box">
                  <div className="stat-num" style={{ color: "var(--yellow)" }}>{allPreds.filter(p => p.outcome === "pending").length}</div>
                  <div className="stat-lbl">Pending</div>
                </div>
                <div className="stat-box">
                  <div className="stat-num">{allPreds.length}</div>
                  <div className="stat-lbl">Total</div>
                </div>
              </div>
            </div>

            <div className="history-title">Prediction History</div>

            {loadingHistory ? (
              <div className="empty-state"><div className="spinner" /></div>
            ) : history.length === 0 ? (
              <div className="empty-state">
                <div className="empty-icon">üì≠</div>
                <div className="empty-text">No predictions yet.<br />Run your first analysis on the home tab!</div>
              </div>
            ) : (
              history.map(entry => (
                <div key={entry.id} className="history-entry">
                  <div className="history-entry-header">
                    <div>
                      <div className="history-match">{entry.match}</div>
                      <div className="history-meta">
                        {entry.sport} ¬∑ {entry.predictions?.length} predictions ¬∑ {new Date(entry.timestamp).toLocaleDateString("en-GB", { day: "numeric", month: "short", year: "numeric" })}
                      </div>
                    </div>
                    <div style={{ textAlign: "right" }}>
                      <div style={{ fontFamily: "'Barlow Condensed',sans-serif", fontSize: 18, fontWeight: 800, color: "var(--green)" }}>
                        {entry.predictions?.filter(p => p.outcome === "win").length}W
                        <span style={{ color: "var(--red)", marginLeft: 6 }}>
                          {entry.predictions?.filter(p => p.outcome === "loss").length}L
                        </span>
                      </div>
                    </div>
                  </div>
                  {entry.predictions?.map(p => (
                    <div key={p.id} className="history-pred-row">
                      <div>
                        <div className="history-pred-market">{p.market}</div>
                        <div className="history-pred-pick">{p.pick}</div>
                        <div className="history-pred-conf">{p.confidence}% confidence</div>
                      </div>
                      <span className={`outcome-badge badge-${p.outcome}`}>
                        {p.outcome.toUpperCase()}
                      </span>
                    </div>
                  ))}
                </div>
              ))
            )}
          </div>
        )}

        {/* Bottom Tabs */}
        <div className="tabs">
          <button className={`tab ${tab === "home" ? "active" : ""}`} onClick={() => setTab("home")}>‚öΩ Analysis</button>
          <button className={`tab ${tab === "account" ? "active" : ""}`} onClick={() => setTab("account")}>üìä My Stats</button>
        </div>
      </div>
    </>
  );
}


    // Mount the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
  <script>
    // API Key management
    const STORAGE_KEY = 'yc_analyst_api_key';

    function getApiKey() {
      return localStorage.getItem(STORAGE_KEY) || '';
    }

    function saveApiKey() {
      const input = document.getElementById('api-key-input');
      const key = input.value.trim();
      if (!key.startsWith('sk-ant-') && !key.startsWith('sk-')) {
        document.getElementById('api-key-error').style.display = 'block';
        return;
      }
      localStorage.setItem(STORAGE_KEY, key);
      document.getElementById('api-key-modal').style.display = 'none';
    }

    function checkApiKey() {
      const key = getApiKey();
      if (!key) {
        document.getElementById('api-key-modal').style.display = 'flex';
      }
    }

    // Make key available globally for the React app
    window.getYCApiKey = getApiKey;
    window.showApiKeyModal = () => {
      document.getElementById('api-key-modal').style.display = 'flex';
    };

    // Check on load
    window.addEventListener('load', checkApiKey);
  </script>
</body>
</html>
